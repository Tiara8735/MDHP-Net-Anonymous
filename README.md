# MDHP-Net-Anonymous
\[**Anonymous**\] Multi-Dimensional Hawkes Process Network

⚠️ The corresponding paper for this repository is currently under review. Following the double-blind principle, this GitHub account and the repository are anonymous. Prior to the completion of the review process, the code in this repository **SHOULD NOT be refered or cited**, and may only be used for reproducing experimental results related to the paper. After the review process, this repository will be deleted, and the official code will be made public under the author's GitHub account.

## 1. Environment and Dependencies

```bash
conda create -n MDHP-Net python=3.12
conda activate MDHP-Net
# [NOTE] You should Install PyTorch manually for GPU support if on Windows, see 
#        "https://pytorch.org/get-started/locally/".
#        For Linux, the following command will install PyTorch automatically.
# Install package `mdhpnet` (with its dependencies).
pip3 install .
```

## 2. Data Preparation

Download `data.7z` from [dropbox](https://www.dropbox.com/scl/fi/938mtzm3qct4oebt8huo3/data.7z?rlkey=jpbn4q0bpdphs3lmtlof05zoy&st=te6rkex4&dl=0).

To extract the data, run the following command:

```bash
7z x data.7z
```

You will get a directory named `data`, put it in the root directory of the project.

Dowload `results.7z` from [dropbox](https://www.dropbox.com/scl/fi/zurhxdyihh9viczrw90ws/results.7z?rlkey=86j980vb5th5po6bzruhettf0&st=zzhz9gbz&dl=0). The results contain the model checkpoints, the training logs, and all the figures and statistics in the paper.

To extract the results, run the following command:

```bash
7z x results.7z
```

You will get a directory named `results`, put it in the root directory of the project.

## 3. Testing

You should test the model with both data and results prepared.

The configuration files are in the "[configs/test](configs/test)" directory.

```bash
python scripts/model_test.py -c <config_file_path>

# For example:
# python scripts/model_test.py -c configs/test/mdhp-gds.yaml
```

The results will be saved in the "[results/test](results/test)" directory by default.

## 4. Training

You can train the model as long as you have the data prepared.

The configuration files are in the "[configs/train](configs/train)" directory.

```bash
bash scripts/model_dist_train.sh <config_file_path>

# For example:
# bash scripts/model_dist_train.sh configs/train/mdhp-net.yaml
```

Note that by default, 2 GPUs are used for distributed training. 

If you only have one GPU, modify the `CUDA_VISIBLE_DEVICES`, `--nproc_per_node`, and `--nnodes` in the `scripts/model_dist_train.sh` file.

For example:

```bash
cfg_file=$1

OMP_NUM_THREADS=1 CUDA_VISIBLE_DEVICES="0"  \
torchrun  \
    --nproc_per_node= 1 \
    --nnodes=1  \
    --node_rank=0  \
    --master_addr="localhost"  \
    --master_port=12345  \
    scripts/dist_train.py  -c $cfg_file
```

The results will be saved in the "[results/train](results/train)" directory by default.

## 5. Figures and Statistics

Most figures and statistics in the paper can be generated by running the python scripts in the "[scripts/figures_and_statistics](scripts/figures_and_statistics)" directory.

The generated figures will be saved the "[results/visualization](results/visualization)" directory by default.

## 6. Speed Test for MDHP-GDS

```bash
python scripts/mdhp-gds_speed_test.py
```

The results will be saved in the "[results](results)" directory by default.
